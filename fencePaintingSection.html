<!-- fencePaintingSection.html -->
<div id="fencingPaintingSection" style="display:block;">
    <div style="display: flex; gap: 5%; margin-top: 20px;">
        <!-- Fencing Information -->
        <div style="background-color: #d7ebf9; padding: 20px; border-radius: 10px; width: 45%;">
            <h3><strong>Fencing Information</strong></h3>
            <hr style="border: 2px solid #000000; width: 95%;">
            
            <label>Fence Type:</label><br>
            <select id="fenceType">
                <option value="">Select...</option>
                <option value="Privacy">Privacy</option>
                <option value="Picket">Picket</option>
                <option value="Chain Link">Chain Link</option>
                <option value="Wrought Iron">Wrought Iron</option>
                <option value="Vinyl">Vinyl</option>
                <option value="Aluminum">Aluminum</option>
                <option value="Composite">Composite</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Material:</label><br>
            <select id="fenceMaterial">
                <option value="">Select...</option>
                <option value="Wood">Wood</option>
                <option value="Vinyl">Vinyl</option>
                <option value="Metal">Metal</option>
                <option value="Composite">Composite</option>
                <option value="Stone">Stone</option>
                <option value="Concrete">Concrete</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Height:</label><br>
            <select id="fenceHeight">
                <option value="">Select...</option>
                <option value="3 ft">3 ft</option>
                <option value="4 ft">4 ft</option>
                <option value="5 ft">5 ft</option>
                <option value="6 ft">6 ft</option>
                <option value="7 ft">7 ft</option>
                <option value="8 ft">8 ft</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Color:</label><br>
            <select id="fenceColor">
                <option value="">Select...</option>
                <option value="Natural">Natural</option>
                <option value="White">White</option>
                <option value="Brown">Brown</option>
                <option value="Black">Black</option>
                <option value="Gray">Gray</option>
                <option value="Green">Green</option>
                <option value="Custom">Custom</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Style:</label><br>
            <select id="fenceStyle">
                <option value="">Select...</option>
                <option value="Traditional">Traditional</option>
                <option value="Modern">Modern</option>
                <option value="Rustic">Rustic</option>
                <option value="Decorative">Decorative</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Owner Status:</label><br>
            <select id="fenceOwnerStatus">
                <option value="">Select...</option>
                <option value="Primary">Primary</option>
                <option value="Secondary">Secondary</option>
                <option value="Tertiary">Tertiary</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Install Date:</label><br>
            <input type="date" id="fenceInstallDate"><br><br>
            
            <label>Warranty Expiration:</label><br>
            <input type="date" id="fenceWarrantyExp"><br><br>
            
            <label>Sales Rep:</label><br>
            <select id="fenceSalesRep">
                <option value="">Select Sales Rep</option>
                <option value="Angel Alvarez">Angel Alvarez</option>
                <option value="Esteban Alexander">Esteban Alexander</option>
                <option value="Lewis Robertson">Lewis Robertson</option>
                <option value="Scott Wilson">Scott Wilson</option>
                <option value="other">Other</option>
            </select>
            <input type="text" id="fenceSalesRepOther" style="display: none; margin-top: 5px;" placeholder="Enter Sales Rep Name">
        </div>
        
        <!-- Painting Information -->
        <div style="background-color: #d7ebf9; padding: 20px; border-radius: 10px; width: 45%;">
            <h3><strong>Painting Information</strong></h3>
            <hr style="border: 2px solid #000000; width: 95%;">
            
            <label>Paint Type:</label><br>
            <select id="paintingType">
                <option value="">Select...</option>
                <option value="Latex">Latex</option>
                <option value="Oil-based">Oil-based</option>
                <option value="Acrylic">Acrylic</option>
                <option value="Enamel">Enamel</option>
                <option value="Chalk">Chalk</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Color:</label><br>
            <select id="paintingColor">
                <option value="">Select...</option>
                <option value="White">White</option>
                <option value="Off-White">Off-White</option>
                <option value="Beige">Beige</option>
                <option value="Gray">Gray</option>
                <option value="Blue">Blue</option>
                <option value="Green">Green</option>
                <option value="Red">Red</option>
                <option value="Yellow">Yellow</option>
                <option value="Brown">Brown</option>
                <option value="Black">Black</option>
                <option value="Custom">Custom</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Brand:</label><br>
            <select id="paintingBrand">
                <option value="">Select...</option>
                <option value="Behr">Behr</option>
                <option value="Sherwin-Williams">Sherwin-Williams</option>
                <option value="Benjamin Moore">Benjamin Moore</option>
                <option value="Valspar">Valspar</option>
                <option value="PPG">PPG</option>
                <option value="Glidden">Glidden</option>
                <option value="Dunn-Edwards">Dunn-Edwards</option>
                <option value="Dutch Boy">Dutch Boy</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Finish:</label><br>
            <select id="paintingFinish">
                <option value="">Select...</option>
                <option value="Flat">Flat</option>
                <option value="Matte">Matte</option>
                <option value="Eggshell">Eggshell</option>
                <option value="Satin">Satin</option>
                <option value="Semi-Gloss">Semi-Gloss</option>
                <option value="Gloss">Gloss</option>
                <option value="High-Gloss">High-Gloss</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Area Painted:</label><br>
            <select id="paintingAreaPainted">
                <option value="">Select...</option>
                <option value="Exterior">Exterior</option>
                <option value="Interior">Interior</option>
                <option value="Both">Both</option>
                <option value="Specific Rooms">Specific Rooms</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Owner Status:</label><br>
            <select id="paintingOwnerStatus">
                <option value="">Select...</option>
                <option value="Primary">Primary</option>
                <option value="Secondary">Secondary</option>
                <option value="Tertiary">Tertiary</option>
                <option value="Other">Other</option>
            </select><br><br>
            
            <label>Paint Date:</label><br>
            <input type="date" id="paintingDate"><br><br>
            
            <label>Warranty Expiration:</label><br>
            <input type="date" id="paintingWarrantyExp"><br><br>
            
            <label>Sales Rep:</label><br>
            <select id="paintingSalesRep">
                <option value="">Select Sales Rep</option>
                <option value="Angel Alvarez">Angel Alvarez</option>
                <option value="Esteban Alexander">Esteban Alexander</option>
                <option value="Lewis Robertson">Lewis Robertson</option>
                <option value="Scott Wilson">Scott Wilson</option>
                <option value="other">Other</option>
            </select>
            <input type="text" id="paintingSalesRepOther" style="display: none; margin-top: 5px;" placeholder="Enter Sales Rep Name">
        </div>
    </div>
    
    <!-- Referral Section -->
    <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ddd;">
        <h3 style="margin-top: 0; border-bottom: 1px solid #ccc; padding-bottom: 10px;">Referral</h3>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
            <div style="width: 48%;">
                <label for="fpFirstName">First Name:</label>
                <input type="text" id="fpFirstName" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="width: 48%;">
                <label for="fpLastName">Last Name:</label>
                <input type="text" id="fpLastName" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>
        
        <div style="display: flex; justify-content: space-between;">
            <div style="width: 48%;">
                <label for="fpPhoneNumber">Phone:</label>
                <input type="text" id="fpPhoneNumber" placeholder="(xxx) xxx-xxxx" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="width: 48%;">
                <label for="fpEmail">Email:</label>
                <input type="email" id="fpEmail" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
        </div>
    </div>
    
    <!-- Notes Section -->
    <div style="margin-bottom: 20px;">
        <div style="margin-bottom: 10px;">
            <label for="fpNotes">Notes:</label>
            <textarea id="fpNotes" placeholder="Enter notes here..." style="width: 100%; height: 100px; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
            <div style="display: flex; justify-content: flex-end; margin-top: 5px;">
                <button id="fpAddNote" style="padding: 5px 10px; background-color: #f8f9fa; border: 1px solid #ccc; border-radius: 4px;">Add Note</button>
            </div>
        </div>
        
        <div>
            <p>Previous Notes:</p>
            <div id="fpPreviousNotes" style="background-color: #ffebee; padding: 10px; border-radius: 4px; min-height: 40px; margin-bottom: 10px;"></div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button id="fpSubmit" style="padding: 10px 20px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Submit</button>
                <button id="fpNewRecord" style="padding: 10px 20px; background-color: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">New Record</button>
            </div>
        </div>
    </div>
    
    <!-- Documents/Images/Videos Section -->
    <div style="background-color: #f0f8ff; padding: 20px; border-radius: 10px; border: 1px solid #ddd;">
        <h3 style="margin-top: 0; margin-bottom: 15px;">Documents/Images/Videos</h3>
        
        <div>
            <button id="fpUpload" style="padding: 8px 20px; background-color: #f8f9fa; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px;">Upload</button>
            <button id="fpViewDownload" style="padding: 8px 20px; background-color: #f8f9fa; border: 1px solid #ccc; border-radius: 4px;">View/Download</button>
        </div>
        <div id="filesList"></div>
    </div>
    
    <script>
    // Initialize the Fencing/Painting section
    document.addEventListener('DOMContentLoaded', function() {
        // Check if the user has the required license
        if (sessionStorage.getItem('keys2Valid') !== '1') {
            // If not, show a notification and hide the section
            showNotification('License required for Fencing/Painting feature', 'error');
            document.getElementById('fencingPaintingSection').style.display = 'none';
            return;
        }
        
        // Set up event listeners for the new UI elements
        setupFencingPaintingUI();
        
        // Initialize the original event handlers if they're still needed
        if (document.getElementById('fenceSalesRep')) {
            initializeFencingPaintingHandlers();
        }
    });
    
    // Set up the new UI elements
    function setupFencingPaintingUI() {
        // Submit button functionality
        const submitBtn = document.getElementById('fpSubmit');
        if (submitBtn) {
            submitBtn.addEventListener('click', function() {
                // Get all the referral information
                const firstName = document.getElementById('fpFirstName').value;
                const lastName = document.getElementById('fpLastName').value;
                const phone = document.getElementById('fpPhoneNumber').value;
                const email = document.getElementById('fpEmail').value;
                
                // Validate the data
                if (!firstName || !lastName) {
                    showNotification('Please enter first and last name', 'error');
                    return;
                }
                
                // In a real application, you would send this data to the server
                console.log('Submitting data:', { firstName, lastName, phone, email });
                showNotification('Data submitted successfully', 'success');
            });
        }
        
        // New Record button functionality
        const newRecordBtn = document.getElementById('fpNewRecord');
        if (newRecordBtn) {
            newRecordBtn.addEventListener('click', function() {
                // Clear all form fields
                const formFields = [
                    'fpFirstName', 
                    'fpLastName', 
                    'fpPhoneNumber', 
                    'fpEmail', 
                    'notesTextarea'
                ];
                
                formFields.forEach(id => {
                    const field = document.getElementById(id);
                    if (field) field.value = '';
                });
                
                // Clear the notes list
                const notesList = document.getElementById('notesList');
                if (notesList) notesList.innerHTML = '';
                
                showNotification('Form cleared for new record', 'success');
            });
        }
        
        // View/Download button functionality
        const viewDownloadBtn = document.getElementById('fpViewDownload');
        if (viewDownloadBtn) {
            viewDownloadBtn.addEventListener('click', function() {
                // In a real application, this would show a list of uploaded files
                if (document.getElementById('filesList').children.length === 0) {
                    showNotification('No files have been uploaded yet', 'info');
                } else {
                    showNotification('Viewing uploaded files', 'success');
                }
            });
        }
        
        // Set up file upload
        const fileUpload = document.getElementById('fileUpload');
        if (fileUpload) {
            fileUpload.addEventListener('change', function() {
                uploadFiles();
            });
        }
    }
    
    // Initialize event handlers for the Fencing/Painting section
    function initializeFencingPaintingHandlers() {
        // Handle "Other" option for Sales Reps
        document.getElementById('fenceSalesRep').addEventListener('change', function() {
            const otherInput = document.getElementById('fenceSalesRepOther');
            otherInput.style.display = this.value === 'other' ? 'block' : 'none';
        });
        
        document.getElementById('paintSalesRep').addEventListener('change', function() {
            const otherInput = document.getElementById('paintSalesRepOther');
            otherInput.style.display = this.value === 'other' ? 'block' : 'none';
        });
        
        // Initialize date fields with today's date
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fenceInstallDate').value = today;
        document.getElementById('paintDate').value = today;
        
        // Calculate warranty expiration dates (assuming 1 year warranty)
        calculateWarrantyDates();
    }
    
    // Calculate warranty expiration dates
    function calculateWarrantyDates() {
        const fenceInstallDate = document.getElementById('fenceInstallDate');
        const fenceWarrantyExpiration = document.getElementById('fenceWarrantyExpiration');
        const paintDate = document.getElementById('paintDate');
        const paintWarrantyExpiration = document.getElementById('paintWarrantyExpiration');
        
        fenceInstallDate.addEventListener('change', function() {
            if (this.value) {
                const date = new Date(this.value);
                date.setFullYear(date.getFullYear() + 1);
                fenceWarrantyExpiration.value = date.toISOString().split('T')[0];
            }
        });
        
        paintDate.addEventListener('change', function() {
            if (this.value) {
                const date = new Date(this.value);
                date.setFullYear(date.getFullYear() + 1);
                paintWarrantyExpiration.value = date.toISOString().split('T')[0];
            }
        });
        
        // Trigger the change event to calculate initial values
        fenceInstallDate.dispatchEvent(new Event('change'));
        paintDate.dispatchEvent(new Event('change'));
    }
    
    // Add a note to the notes list
    function addNote() {
        const notesTextarea = document.getElementById('notesTextarea');
        const notesList = document.getElementById('notesList');
        
        if (notesTextarea.value.trim() === '') {
            showNotification('Please enter a note', 'error');
            return;
        }
        
        const now = new Date();
        const dateString = now.toLocaleDateString();
        const timeString = now.toLocaleTimeString();
        
        const noteDiv = document.createElement('div');
        noteDiv.style.padding = '10px';
        noteDiv.style.marginBottom = '10px';
        noteDiv.style.backgroundColor = '#f8f9fa';
        noteDiv.style.borderRadius = '5px';
        noteDiv.style.border = '1px solid #dee2e6';
        
        noteDiv.innerHTML = `
            <div style="font-weight: bold;">${dateString} ${timeString}</div>
            <div>${notesTextarea.value}</div>
        `;
        
        notesList.appendChild(noteDiv);
        notesTextarea.value = '';
    }
    
    // Upload files
    function uploadFiles() {
        const fileUpload = document.getElementById('fileUpload');
        const filesList = document.getElementById('filesList');
        
        if (fileUpload.files.length === 0) {
            showNotification('Please select files to upload', 'error');
            return;
        }
        
        // In a real application, you would upload the files to a server
        // For this example, we'll just display the file names
        for (let i = 0; i < fileUpload.files.length; i++) {
            const file = fileUpload.files[i];
            
            const fileDiv = document.createElement('div');
            fileDiv.style.padding = '10px';
            fileDiv.style.marginBottom = '10px';
            fileDiv.style.backgroundColor = '#f8f9fa';
            fileDiv.style.borderRadius = '5px';
            fileDiv.style.border = '1px solid #dee2e6';
            fileDiv.style.display = 'flex';
            fileDiv.style.justifyContent = 'space-between';
            fileDiv.style.alignItems = 'center';
            
            // Determine file type icon
            let fileIcon = 'ðŸ“„';
            if (file.type.startsWith('image/')) {
                fileIcon = 'ðŸ–¼ï¸';
            } else if (file.type.startsWith('video/')) {
                fileIcon = 'ðŸŽ¬';
            } else if (file.type.startsWith('audio/')) {
                fileIcon = 'ðŸ”Š';
            }
            
            fileDiv.innerHTML = `
                <div>
                    <span style="margin-right: 10px;">${fileIcon}</span>
                    <span>${file.name}</span>
                </div>
                <button type="button" class="btn btn-sm btn-danger" onclick="this.parentNode.remove()">Remove</button>
            `;
            
            filesList.appendChild(fileDiv);
        }
        
        // Clear the file input
        fileUpload.value = '';
        
        showNotification('Files uploaded successfully', 'success');
    }

    // Add this function to fencePaintingSection.html
    function getFencePaintingData() {
      return {
        fenceType: document.getElementById('fenceType').value,
        fenceMaterial: document.getElementById('fenceMaterial').value,
        fenceHeight: document.getElementById('fenceHeight').value,
        fenceColor: document.getElementById('fenceColor').value,
        fenceStyle: document.getElementById('fenceStyle').value,
        fenceOwnerStatus: document.getElementById('fenceOwnerStatus').value,
        fenceInstallDate: document.getElementById('fenceInstallDate').value,
        fenceWarrantyExp: document.getElementById('fenceWarrantyExp').value, // Changed from fenceWarrantyExp
        fenceSalesRep: document.getElementById('fenceSalesRep').value === 'other' 
          ? document.getElementById('fenceSalesRepOther').value 
          : document.getElementById('fenceSalesRep').value,
        
        paintingType: document.getElementById('paintingType').value, // Changed from paintingType
        paintingColor: document.getElementById('paintingColor').value, // Changed from paintingColor
        paintingBrand: document.getElementById('paintingBrand').value, // Changed from paintingBrand
        paintingFinish: document.getElementById('paintingFinish').value, // Changed from paintingFinish
        paintingAreaPainted: document.getElementById('paintingareaingPainted').value, // Changed from paintingAreaPainted
        paintingOwnerStatus: document.getElementById('paintingOwnerStatus').value, // Changed from paintingOwnerStatus
        paintingDate: document.getElementById('paintingDate').value, // Changed from paintingDate
        paintingWarrantyExp: document.getElementById('paintingWarrantyExp').value, // Changed from paintingWarrantyExp
        paintingSalesRep: document.getElementById('paintingSalesRep').value === 'other' // Changed from paintingSalesRep
          ? document.getElementById('paintingSalesRepOther').value // Changed from paintingSalesRepOther
          : document.getElementById('paintingSalesRep').value, // Changed from paintingSalesRep
    
        fpFirstName: document.getElementById('fpFirstName').value,
        fpLastName: document.getElementById('fpLastName').value,
        fpPhoneNumber: document.getElementById('fpPhoneNumber').value,
        fpEmail: document.getElementById('fpEmail').value    
      };
    }

    // Make this function accessible globally
    window.getFencePaintingData = getFencePaintingData;

    // Add this function to fencePaintingSection.html
    function setFencePaintingData(data) {
      console.log('Setting fence/painting data:', data);
      console.log('Fence type from data:', data.fenceType);
      console.log('Paint type from data:', data.paintingType);
      
      // Helper function to safely set field values
      const setFieldValue = (id, value) => {
        const element = document.getElementById(id);
        if (!element) {
          console.warn(`Element with ID '${id}' not found.`);
          return;
        }
        
        // For select elements, use the special helper
        if (element.tagName === 'SELECT') {
          setSelectValue(element, value);
        } else {
          // For other elements (like input), just set the value directly
          element.value = value || '';
        }
      };

      // Set fence fields
      setFieldValue('fenceType', data.fenceType);
      setFieldValue('fenceMaterial', data.fenceMaterial);
      setFieldValue('fenceHeight', data.fenceHeight);
      setFieldValue('fenceColor', data.fenceColor);
      setFieldValue('fenceStyle', data.fenceStyle);
      setFieldValue('fenceOwnerStatus', data.fenceOwnerStatus);
      setFieldValue('fenceInstallDate', data.fenceInstallDate);
      setFieldValue('fenceWarrantyExp', data.fenceWarrantyExp);
      
      // Handle fence sales rep with "other" option
      const fenceSalesSelect = document.getElementById('fenceSalesRep');
      const fenceSalesOther = document.getElementById('fenceSalesRepOther');
      
      if (data.fenceSalesRep && fenceSalesSelect) {
        // Check if value exists in dropdown
        let valueExists = false;
        for (let i = 0; i < fenceSalesSelect.options.length; i++) {
          if (fenceSalesSelect.options[i].value === data.fenceSalesRep) {
            fenceSalesSelect.value = data.fenceSalesRep;
            valueExists = true;
            break;
          }
        }
        
        // If not in dropdown, use "other"
        if (!valueExists) {
          fenceSalesSelect.value = 'other';
          if (fenceSalesOther) {
            fenceSalesOther.value = data.fenceSalesRep;
            fenceSalesOther.style.display = 'block';
          }
        } else if (fenceSalesOther) {
          fenceSalesOther.style.display = 'none';
        }
      } else if (fenceSalesSelect) {
        fenceSalesSelect.value = '';
        if (fenceSalesOther) {
          fenceSalesOther.style.display = 'none';
        }
      }
      
      // Set painting fields - note the ID mismatches between HTML and database fields
      setFieldValue('paintingType', data.paintingType);
      setFieldValue('paintingColor', data.paintingColor);
      setFieldValue('paintingBrand', data.paintingBrand);
      setFieldValue('paintingFinish', data.paintingFinish);
      setFieldValue('paintingAreaPainted', data.paintingAreaPainted);
      setFieldValue('paintingOwnerStatus', data.paintingOwnerStatus);
      setFieldValue('paintingDate', data.paintingDate);
      setFieldValue('paintingWarrantyExp', data.paintingWarrantyExp);
      
      // Handle painting sales rep with "other" option
      const paintingSalesSelect = document.getElementById('paintingSalesRep');
      const paintingSalesOther = document.getElementById('paintingSalesRepOther');
      
      if (data.paintingSalesRep && paintingSalesSelect) {
        // Check if value exists in dropdown
        let valueExists = false;
        for (let i = 0; i < paintingSalesSelect.options.length; i++) {
          if (paintingSalesSelect.options[i].value === data.paintingSalesRep) {
            paintingSalesSelect.value = data.paintingSalesRep;
            valueExists = true;
            break;
          }
        }
        
        // If not in dropdown, use "other"
        if (!valueExists) {
          paintingSalesSelect.value = 'other';
          if (paintingSalesOther) {
            paintingSalesOther.value = data.paintingSalesRep;
            paintingSalesOther.style.display = 'block';
          }
        } else if (paintingSalesOther) {
          paintingSalesOther.style.display = 'none';
        }
      } else if (paintingSalesSelect) {
        paintingSalesSelect.value = '';
        if (paintingSalesOther) {
          paintingSalesOther.style.display = 'none';
        }
      }
      
      // Set referral fields
      setFieldValue('fpFirstName', data.fpFirstName);
      setFieldValue('fpLastName', data.fpLastName);
      setFieldValue('fpPhoneNumber', data.fpPhoneNumber);
      setFieldValue('fpEmail', data.fpEmail);

      console.log('Fence type element after setting:', document.getElementById('fenceType'));
      console.log('Fence type value after setting:', document.getElementById('fenceType').value);
    }

function setSelectValue(selectElement, value) {
  if (!selectElement) return;
  
  // If no value provided, just set to empty and return
  if (!value) {
    selectElement.value = '';
    return;
  }
  
  // Try to find if the value exists in the options
  let optionFound = false;
  for (let i = 0; i < selectElement.options.length; i++) {
    if (selectElement.options[i].value === value) {
      selectElement.value = value;
      optionFound = true;
      break;
    }
  }
  
  // If not found and value is non-empty, add new option
  if (!optionFound && value) {
    console.log('Adding new option for value:', value);
    let newOption = document.createElement('option');
    newOption.value = value;
    newOption.text = value;
    selectElement.add(newOption);
    
    // Force set the value after adding the option
    setTimeout(() => {
      selectElement.value = value;
      console.log('Value after setting:', selectElement.value);
    }, 0);
  }
}


    // Make this function accessible globally
    window.setFencePaintingData = setFencePaintingData;

    // Add event listener for the Add Note button
    document.getElementById('fpAddNote').addEventListener('click', addNote);
    </script>
</div>
